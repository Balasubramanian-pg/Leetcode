# Valid Serial Number Identification in Product Descriptions

## Overview

> [!NOTE]  
> This problem requires identifying products containing valid serial numbers in their descriptions using precise pattern matching with regular expressions.

## 1. Problem Description

### 1.1 Table Structure

> [!TIP]  
> The products table contains product information including descriptions that may contain serial numbers.

```
+--------------+------------+
| Column Name  | Type       |
+--------------+------------+
| product_id   | int        |
| product_name | varchar    |
| description  | varchar    |
+--------------+------------+
```

> [!IMPORTANT]  
> The solution must identify serial numbers matching the exact pattern "SN" followed by 4 digits, a hyphen, and 4 more digits, appearing anywhere in the description.

## 2. Solution Approach

### 2.1 Pattern Matching Concept

> [!TIP]  
> The regex pattern must validate:
> - Literal "SN" prefix (case-sensitive)
> - Exactly 4 digits before hyphen
> - Exactly 4 digits after hyphen
> - Pattern can appear anywhere in text

> [!WARNING]  
> Must ensure the pattern doesn't match invalid sequences like "SN1234-56789" (5 digits after hyphen).

### 2.2 SQL Solution

```sql
SELECT
    product_id,
    product_name,
    description
FROM products
WHERE description REGEXP '(^|[^A-Za-z0-9])SN[0-9]{4}-[0-9]{4}([^A-Za-z0-9]|$)'
ORDER BY product_id;
```

> [!NOTE]  
> The enhanced regex ensures the serial number is properly delimited by non-alphanumeric characters or string boundaries.

## 3. Example Output

> [!EXAMPLE]  
> Correctly identifies products with properly formatted serial numbers.

```
+------------+--------------+------------------------------------------------------+
| product_id | product_name | description                                          |
+------------+--------------+------------------------------------------------------+
| 1          | Widget A     | This is a sample product with SN1234-5678            |
| 2          | Widget B     | A product with serial SN9876-1234 in the description |
| 5          | Widget E     | Check out SN4321-8765 in this description            |
+------------+--------------+------------------------------------------------------+
```

## 4. Alternative Approaches

### 4.1 Using Word Boundaries

```sql
-- MySQL specific word boundary approach
SELECT product_id, product_name, description
FROM products
WHERE description REGEXP '[[:<:]]SN[0-9]{4}-[0-9]{4}[[:>:]]'
ORDER BY product_id;
```

### 4.2 Using Multiple Conditions

> [!NOTE]  
> For databases without full regex support, combine LIKE and SUBSTRING operations.

```sql
SELECT product_id, product_name, description
FROM products
WHERE description LIKE '%SN____-____%'
  AND LENGTH(SUBSTRING_INDEX(SUBSTRING_INDEX(description, 'SN', -1), '-', 1)) = 5
  AND LENGTH(SUBSTRING_INDEX(SUBSTRING_INDEX(description, '-', -1), ' ', 1)) = 4
ORDER BY product_id;
```

## 5. Performance Considerations

> [!IMPORTANT]  
> For large tables:
> - Consider adding a full-text index on the description column
> - Pre-filter with simple patterns before applying complex regex
> - Materialize results for frequently queried patterns

## 6. Common Mistakes

> [!CAUTION]  
> Using `SN[0-9]{4}-[0-9]{4}` without delimiters could match invalid patterns like "XSN1234-5678Y"

> [!WARNING]  
> Forgetting case-sensitivity requirement for "SN" prefix

## 7. Real-World Application

> [!TIP]  
> Similar pattern matching is used for:
> - Inventory management systems
> - Warranty validation
> - Product authentication services

## 8. Edge Cases

> [!NOTE]  
> The solution correctly handles:
> - Serial numbers at start/end of description
> - Descriptions with multiple potential matches
> - Non-alphanumeric characters surrounding serial numbers
> - Invalid patterns with extra digits

## 9. Pattern Explanation

The enhanced regex `(^|[^A-Za-z0-9])SN[0-9]{4}-[0-9]{4}([^A-Za-z0-9]|$)` ensures:
1. `(^|[^A-Za-z0-9])` - Starts at string beginning or after non-alphanumeric
2. `SN` - Literal case-sensitive prefix
3. `[0-9]{4}` - Exactly 4 digits
4. `-` - Hyphen separator
5. `[0-9]{4}` - Exactly 4 digits
6. `([^A-Za-z0-9]|$)` - Ends before alphanumeric or at string end

## 10. Cross-Database Solutions

### 10.1 PostgreSQL Version

```sql
SELECT product_id, product_name, description
FROM products
WHERE description ~ '(^|[^A-Za-z0-9])SN[0-9]{4}-[0-9]{4}([^A-Za-z0-9]|$)'
ORDER BY product_id;
```

### 10.2 SQL Server Version

```sql
SELECT product_id, product_name, description
FROM products
WHERE description LIKE '%SN[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9]%'
  AND description NOT LIKE '%SN[0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9][0-9]%'
ORDER BY product_id;
```
