# Valid Email Identification Using Regular Expressions

## Overview

> [!NOTE]  
> This problem demonstrates advanced email validation using regular expressions in SQL, enforcing multiple business rules for valid email formats.

## 1. Problem Description

### 1.1 Table Structure

> [!TIP]  
> The Users table contains email addresses that need validation against specific format requirements.

```
+-----------------+---------+
| Column Name     | Type    |
+-----------------+---------+
| user_id         | int     |
| email           | varchar |
+-----------------+---------+
```

> [!IMPORTANT]  
> The solution must enforce four strict validation criteria simultaneously through a single regular expression pattern.

## 2. Solution Approach

### 2.1 Regular Expression Concept

> [!TIP]  
> The regex pattern must validate:
> 1. Exactly one '@' symbol
> 2. '.com' suffix
> 3. Alphanumeric + underscore local part
> 4. Letter-only domain name

> [!WARNING]  
> Special characters like '.' in regex must be properly escaped with double backslashes in SQL.

### 2.2 SQL Solution

```sql
SELECT
    user_id,
    email
FROM Users
WHERE email REGEXP '^[A-Za-z0-9_]+@[A-Za-z]+\\\\.com$'
ORDER BY user_id;
```

> [!NOTE]  
> The REGEXP operator provides comprehensive pattern matching capabilities while maintaining query performance.

## 3. Example Output

> [!EXAMPLE]  
> The output shows only emails that strictly conform to all validation rules.

```
+---------+-------------------+
| user_id | email             |
+---------+-------------------+
| 1       | alice@example.com |
| 4       | david@domain.com  |
+---------+-------------------+
```

## 4. Alternative Approaches

### 4.1 Using Multiple Conditions

> [!TIP]  
> For databases without REGEXP, multiple LIKE conditions can approximate the solution.

```sql
SELECT user_id, email
FROM Users
WHERE email LIKE '%@%.com'
  AND email NOT LIKE '%@%@%'
  AND SUBSTRING_INDEX(email, '@', 1) REGEXP '^[A-Za-z0-9_]+$'
  AND SUBSTRING_INDEX(SUBSTRING_INDEX(email, '@', -1), '.', 1) REGEXP '^[A-Za-z]+$';
```

### 4.2 Using SUBSTRING_INDEX

> [!NOTE]  
> This approach separates email components for individual validation.

```sql
SELECT user_id, email
FROM Users
WHERE 
    CHAR_LENGTH(email) - CHAR_LENGTH(REPLACE(email, '@', '')) = 1
    AND RIGHT(email, 4) = '.com'
    AND SUBSTRING_INDEX(email, '@', 1) REGEXP '^[A-Za-z0-9_]+$'
    AND SUBSTRING_INDEX(SUBSTRING_INDEX(email, '@', -1), '.', 1) REGEXP '^[A-Za-z]+$';
```

## 5. Performance Considerations

> [!IMPORTANT]  
> For large datasets:
> - Add an index on the email column
> - Consider pre-filtering with simple conditions before regex
> - Use persisted computed columns for validated emails in production

## 6. Common Mistakes

> [!CAUTION]  
> Forgetting to escape the period in '.com' (needs \\\\. in MySQL)
> Not anchoring patterns with ^ and $ which could allow partial matches

## 7. Real-World Application

> [!TIP]  
> Similar email validation patterns are used in:
> - User registration systems
> - Data cleaning pipelines
> - Compliance reporting

## 8. Edge Cases

> [!NOTE]  
> The solution correctly handles:
> - Emails with multiple @ symbols
> - Invalid domain formats
> - Non-alphanumeric characters in local part
> - Missing .com suffix

## 9. Pattern Breakdown

The regex `^[A-Za-z0-9_]+@[A-Za-z]+\\\\.com$` components:
1. `^` - Start of string
2. `[A-Za-z0-9_]+` - 1+ alphanumeric/underscore chars (local part)
3. `@` - Literal @ symbol
4. `[A-Za-z]+` - 1+ letters (domain name)
5. `\\.com$` - Literal .com at string end

## 10. Cross-Database Solutions

### 10.1 PostgreSQL Version

```sql
SELECT user_id, email
FROM Users
WHERE email ~ '^[A-Za-z0-9_]+@[A-Za-z]+\.com$'
ORDER BY user_id;
```

### 10.2 SQL Server Version

```sql
SELECT user_id, email
FROM Users
WHERE email LIKE '%_@__%.com'
  AND email NOT LIKE '%@%@%'
  AND PATINDEX('%[^a-zA-Z0-9_]%@%', email) = 0
  AND PATINDEX('%@[^a-zA-Z]%.com%', email) = 0
ORDER BY user_id;
```
